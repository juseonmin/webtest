<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experiment Data Search</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="initialContainer" class="container">
        <img src="web/logo.png" alt="Experiment Data Search Logo" class="logo">
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Enter gene name to search data...">
            <button id="searchButton">üîç</button>
            <div id="dropdown" class="dropdown-content"></div>
        </div>
    </div>
    <div id="resultContainer" class="container result-container" style="display: none;">
        <div class="left-panel" id="dataContainer"></div>
        <div class="right-panel" id="forwebDataContainer"></div>
    </div>

    <script>
        fetch('imageList.json')
            .then(response => response.json())
            .then(images => {
                const searchInput = document.getElementById('searchInput');
                const searchButton = document.getElementById('searchButton');
                const dropdown = document.getElementById('dropdown');
                const initialContainer = document.getElementById('initialContainer');
                const resultContainer = document.getElementById('resultContainer');
                const dataContainer = document.getElementById('dataContainer');
                const forwebDataContainer = document.getElementById('forwebDataContainer');

                function fetchUniprotData(uniprot) {
                    return fetch('uniprot_data.json')
                        .then(response => response.json())
                        .then(data => data.find(item => item.From === uniprot));
                }

                function fetchForwebData(uniprot) {
                    return fetch('forweb.json')
                        .then(response => response.json())
                        .then(data => data.filter(item => item.ProteinID === uniprot));
                }

                function renderImages(filteredImages) {
                    dataContainer.innerHTML = '';
                    forwebDataContainer.innerHTML = '';
                    if (filteredImages.length === 0) {
                        const noDataMessage = document.createElement('div');
                        noDataMessage.className = 'no-data';
                        noDataMessage.textContent = 'No data';
                        dataContainer.appendChild(noDataMessage);
                    } else {
                        filteredImages.forEach(image => {
                            const div = document.createElement('div');
                            div.className = 'image-item';
                            const img = document.createElement('img');
                            img.src = `images/${image}`;
                            div.appendChild(img);
                            dataContainer.appendChild(div);

                            const uniprot = image.split('_')[1].split('.')[0];
                            fetchUniprotData(uniprot).then(uniprotData => {
                                if (uniprotData) {
                                    const uniprotTable = document.createElement('div');
                                    uniprotTable.className = 'uniprot-data';
                                    uniprotTable.innerHTML = `
                                        <div class="table-container">
                                            <table class="uniprot-table">
                                                <tr>
                                                    <th>From</th>
                                                    <td>${uniprotData.From}</td>
                                                </tr>
                                                <tr>
                                                    <th>Length</th>
                                                    <td>${uniprotData.Length}</td>
                                                </tr>
                                                <tr>
                                                    <th>Mass</th>
                                                    <td>${uniprotData.Mass}</td>
                                                </tr>
                                                <tr>
                                                    <th>Keywords</th>
                                                    <td>${uniprotData.Keywords}</td>
                                                </tr>
                                                <tr>
                                                    <th>Gene Ontology (cellular component)</th>
                                                    <td>${uniprotData['Gene Ontology (cellular component)']}</td>
                                                </tr>
                                                <tr>
                                                    <th>Gene Ontology (biological process)</th>
                                                    <td>${uniprotData['Gene Ontology (biological process)']}</td>
                                                </tr>
                                                <tr>
                                                    <th>Gene Ontology (molecular function)</th>
                                                    <td>${uniprotData['Gene Ontology (molecular function)']}</td>
                                                </tr>
                                            </table>
                                        </div>
                                    `;
                                    dataContainer.appendChild(uniprotTable);
                                }
                            });

                            fetchForwebData(uniprot).then(forwebData => {
                                if (forwebData.length > 0) {
                                    const forwebTable = document.createElement('div');
                                    forwebTable.className = 'forweb-data';
                                    let tableContent = `
                                        <div class="table-container">
                                            <table class="forweb-table">
                                                <tr>
                                                    <th>Experiment</th>
                                                    <th>range</th>
                                                    <th>RNAbinding</th>
                                                    <th>start</th>
                                                    <th>end</th>
                                                    <th>Category</th>
                                                </tr>
                                    `;
                                    forwebData.forEach(row => {
                                        tableContent += `
                                            <tr>
                                                <td>${row.Experiment}</td>
                                                <td>${row.range}</td>
                                                <td>${row.RNAbinding}</td>
                                                <td>${row.start}</td>
                                                <td>${row.end}</td>
                                                <td>${row.Category}</td>
                                            </tr>
                                        `;
                                    });
                                    tableContent += '</table></div>';
                                    forwebTable.innerHTML = tableContent;
                                    forwebDataContainer.appendChild(forwebTable);
                                }
                            });
                        });
                    }
                }

                function handleSearch() {
                    const searchTerm = searchInput.value.toLowerCase();
                    const filteredImages = images.filter(image => {
                        const prefix = image.split('_')[0].toLowerCase();
                        return prefix === searchTerm;
                    });
                    initialContainer.style.display = 'none';
                    resultContainer.style.display = 'flex';
                    renderImages(filteredImages);
                }

                searchButton.addEventListener('click', handleSearch);
                searchInput.addEventListener('input', () => {
                    const searchTerm = searchInput.value.toLowerCase();
                    const matchedItems = images.filter(image => {
                        const prefix = image.split('_')[0].toLowerCase();
                        return prefix.startsWith(searchTerm);
                    }).map(image => image.split('_')[0]);

                    dropdown.innerHTML = '';
                    if (matchedItems.length > 0 && searchTerm.length > 0) {
                        dropdown.style.display = 'block';
                        matchedItems.forEach(item => {
                            const option = document.createElement('div');
                            option.className = 'dropdown-item';
                            option.textContent = item;
                            option.addEventListener('click', () => {
                                searchInput.value = item;
                                dropdown.innerHTML = '';
                                dropdown.style.display = 'none';
                                handleSearch();
                            });
                            dropdown.appendChild(option);
                        });
                    } else {
                        dropdown.style.display = 'none';
                    }
                });

                searchInput.addEventListener('keypress', event => {
                    if (event.key === 'Enter') {
                        dropdown.innerHTML = '';
                        dropdown.style.display = 'none';
                        handleSearch();
                    }
                });

                // Ï¥àÍ∏∞ÏóêÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÌëúÏãúÎêòÏßÄ ÏïäÏùå
                dataContainer.innerHTML = '';
                forwebDataContainer.innerHTML = '';
            })
            .catch(error => console.error('Error loading image list:', error));
    </script>
</body>
</html>
